<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Shop -->
  <template id="dobtor_product_extend_assets_fronted" inherit_id="website.assets_frontend" name="Website assets">
    <xpath expr="." position="inside">
      <link rel='stylesheet' href='/dobtor_website_sales/static/src/css/dobtor_product_style.css'/>
    </xpath>
  </template>
  <!-- <template id="product_cart_update_extend" inherit_id="website_sale.product" customize_show="True" name="invisible Price and Cart"><xpath expr="//form[@class='js_add_cart_variants']" position="attributes"><attribute name="style">display: none;</attribute></xpath></template> -->
  <template id="product_detail_extend" inherit_id="website_sale.product">
    <xpath expr="//div[@id='product_details']/h1" position="after">
      <t t-if="product.main_point">
        <div class="product_info">
          <ul>
            <t t-foreach="product.main_point" t-as="item">
              <li t-if="item.isvisible">
                <span t-field="item.name"/>
              </li>
            </t>
          </ul>
        </div>
      </t>
    </xpath>
    <xpath expr="//div[@id='product_details']/p[@class='text-muted']" position="replace"></xpath>
  </template>
  <!-- Override Main_point -->
  <template id="product_detail_override" inherit_id="dobtor_website_sales.product_detail_extend">
    <xpath expr="//t[@t-if='product.main_point']" position="replace">
      <div class="product_info_overrid">
        <div t-field="product.product_feature"></div>
      </div>
    </xpath>
  </template>
  <!-- Tab -->
  <template id="product_tab_extend" inherit_id="website_sale.product">
    <xpath expr="//div[@t-field='product.website_description']" position="attributes">
      <attribute name="style">display: none;</attribute>
    </xpath>
    <xpath expr="//section" position="after">
      <section class="container mt8 oe_website_sale">
        <div class="container">
          <div class="row" t-att-id="'product_tab_%s' %(product.id)">
            <div class="col-md-12">
              <!--Nav Tab-->
              <ul class="nav nav-tabs" role="tablist" t-att-id="'prodTabs_%s' %(product.id)">
                <li role="presentation">
                  <a t-att-href="'#divTab1_%s' %(product.id)" t-att-aria-controls="'Tab1_%s' %(product.id)" role="tab" data-toggle="tab">Product Detail</a>
                </li>
                <li role="presentation">
                  <a t-att-href="'#divTab2_%s' %(product.id)" t-att-aria-controls="'Tab3_%s' %(product.id)" role="tab" data-toggle="tab">Ordering Information</a>
                </li>
                <li role="presentation" class="active">
                  <a t-att-href="'#divTab3_%s' %(product.id)" t-att-aria-controls="'Tab2_%s' %(product.id)" role="tab" data-toggle="tab">Specification</a>
                </li>
                <li role="presentation">
                  <a t-att-href="'#divTab4_%s' %(product.id)" t-att-aria-controls="'Tab4_%s' %(product.id)" role="tab" data-toggle="tab">Download</a>
                </li>
              </ul>
              <!--Tab panes-->
              <div class="tab-content">
                <!--Tab1-->
                <div role="tabpanel" class="oe_structure mt16 tab-pane" t-att-id="'divTab1_%s' %(product.id)" t-field="product.website_description"></div>
                <!--Tab2-->
                <div role="tabpanel" class="oe_structure mt16 tab-pane" t-att-id="'divTab2_%s' %(product.id)" t-field="product.website_Ordering_Information"></div>
                <!--Tab3-->
                <div role="tabpanel" class="tab-pane active" t-att-id="'divTab3_%s' %(product.id)">
                  <t t-if="product.relational">
                    <br/>
                    <table t-att-id="'product_Rule_%s' %(product.id)" class="table table-hover table-bordered">
                      <thead>
                        <th>Class</th>
                        <th>Info</th>
                        <th>Content</th>
                      </thead>
                      <tbody>
                        <t t-value="0" t-set="temp_index"/>
                        <t t-value="0" t-set="class_index"/>
                        <t t-value="0" t-set="content_index"/>
                        <t t-foreach="product.relational" t-as="item">
                          <tr t-if="item.isvisible">
                            <t t-value="product.relational.search_count([('FKClass','=',item.FKClass.id),('product_id','=',product.id),('isvisible','=',True)])" t-set="classrowspan"/>
                            <t t-if="class_index == 0">
                              <td t-att-rowspan="classrowspan">
                                <span t-field="item.FKClass.name"/>
                              </td>
                              <t t-value="classrowspan" t-set="class_index"/></t>
                            <t t-if="class_index != 0">
                              <t t-value="class_index - 1" t-set="class_index"/></t>
                            <t t-value="product.relational.search_count([('FKClass','=',item.FKClass.id),('FKInfo','=',item.FKInfo.id),('product_id','=',product.id),('isvisible','=',True)])" t-set="rowspan"/>
                            <t t-if="temp_index == 0">
                              <td t-att-rowspan="rowspan">
                                <span t-field="item.FKInfo.name"/>
                              </td>
                              <t t-value="rowspan" t-set="temp_index"/></t>
                            <t t-if="temp_index != 0">
                              <t t-value="temp_index - 1" t-set="temp_index"/></t>
                            <t t-value="product.relational.search_count([('FKClass','=',item.FKClass.id),('FKInfo','=',item.FKInfo.id),('product_id','=',product.id),('isvisible','=',True)])" t-set="contentrowspan"/>
                            <t t-if="content_index == 0">
                              <td t-att-rowspan="contentrowspan">
                                <ul t-foreach="product.relational.search([('FKClass','=',item.FKClass.id),('FKInfo','=',item.FKInfo.id),('product_id','=',product.id),('isvisible','=',True)])" t-as="content_item">
                                  <li>
                                    <span t-field="content_item.FKContent.name"/>
                                  </li>
                                </ul>
                              </td>
                              <t t-value="contentrowspan" t-set="content_index"/></t>
                            <t t-if="content_index != 0">
                              <t t-value="content_index - 1" t-set="content_index"/></t>
                            <!-- <td><span t-field="item.FKContent.name"/></td> -->
                          </tr>
                        </t>
                      </tbody>
                    </table>
                  </t>
                </div>
                <!--Tab4-->
                <div role="tabpanel" class="tab-pane" t-att-id="'divTab4_%s' %(product.id)"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </xpath>
  </template>
  <!-- title -->
  <template id="dobtor_list_table_title" inherit_id="website_sale.products">
    <xpath expr="//div[@id='products_grid']" position="before">
      <div id="test" class="">
        <div class="oe_product oe_list hidden-xs" style="min-height: 40px;">
          <div class="row">
            <div class="col-md-3"></div>
            <t t-value="[]" t-set="temp"/>
            <t t-foreach="products" t-as="product">
              <t t-value="0" t-set="temp_index"/>
              <t t-foreach="product.relational" t-as="item">
                <t t-if="item.isvisible">
                  <t t-value="product.relational.search_count([('FKInfo','=',item.FKInfo.id),('product_id','=',product.id),('isvisible','=',True)])" t-set="rowspan"/>
                  <t t-if="temp_index == 0">
                    <div t-if="item.FKInfo.show and item.FKInfo.name not in temp" class="col-md-3" style="padding-left: 55px;">
                      <span t-field="item.FKInfo.name"/>
                    </div>
                    <t t-value="rowspan" t-set="temp_index"/>
                    <t t-value="temp + [item.FKInfo.name]" t-set="temp"/></t>
                  <t t-if="temp_index != 0">
                    <t t-value="temp_index - 1" t-set="temp_index"/></t>
                </t>
              </t>
            </t>
          </div>
        </div>
      </div>
    </xpath>
  </template>
  <template id="dobtor_list_table" inherit_id="website_sale.products_item">
    <xpath expr="//form/div" position="attributes">
      <attribute name="class">row</attribute>
    </xpath>
    <xpath expr="//form/div/section" position="attributes">
      <attribute name="class">col-md-3</attribute>
    </xpath>
    <xpath expr="//div[@id='website_published_button']" position="attributes">
      <attribute name="style">display:grid;position: absolute;bottom: 0px;</attribute>
    </xpath>
    <xpath expr="//form/div/section" position="after">
      <t t-value="0" t-set="content_index"/>
      <t t-foreach="product.relational" t-as="item">
        <t t-if="item.isvisible">
          <t t-value="product.relational.search_count([('FKInfo','=',item.FKInfo.id),('product_id','=',product.id),('isvisible','=',True)])" t-set="contentrowspan"/>
          <t t-if="content_index == 0">
            <div t-if="item.FKInfo.show" class="col-md-3 hidden-xs">
              <ul style="margin-top: 10px;">
                <li t-foreach="product.relational.search([('FKInfo','=',item.FKInfo.id),('product_id','=',product.id),('isvisible','=',True)])" t-as="content_item">
                  <span t-field="content_item.FKContent.name" style="word-wrap: break-word;"/>
                </li>
              </ul>
            </div>
            <t t-value="contentrowspan" t-set="content_index"/></t>
          <t t-if="content_index != 0">
            <t t-value="content_index - 1" t-set="content_index"/></t>
        </t>
      </t>
    </xpath>
  </template>
  <template id="dobtor_products_other_description" inherit_id="dobtor_website_sales.product_tab_extend">
    <xpath expr="//section[last()]" position="before">
      <section class="container mt8 oe_website_sale">
        <div t-field="product.website_other_description"></div>
      </section>
    </xpath>
  </template>
  <!-- patch 2017-11-29 -->
  <template id="dobtor_sale_font_under_img" inherit_id="website_sale.products_item">
    <xpath expr="//div[@class='oe_product_image']/a" position="inside">
      <b class="sale_font_under_img" t-field="product.name"></b>
    </xpath>
    <xpath expr="//div[@id='website_published_button']" position="attributes">
      <attribute name="style">display:none;</attribute>
    </xpath>
    <xpath expr="//form/div/section" position="attributes">
      <attribute name="class">hidden</attribute>
    </xpath>
  </template>
  <!-- title -->
  <template id="dobtor_list_table_title_override" inherit_id="dobtor_website_sales.dobtor_list_table_title">
    <xpath expr="//div[@id='test']" position="replace">
      <div id="test" class="">
        <div class="oe_product oe_list hidden-xs" style="min-height: 40px;">
          <div class="row">
            <t t-foreach="website.get_show_info()" t-as="item">
              <div class="col-md-3" style="padding-left: 55px;">
                <span t-field="item.name"/>
              </div>
            </t>
          </div>
        </div>
      </div>
    </xpath>
  </template>
  <!-- item -->
  <template id="dobtor_list_table_overrid" inherit_id="dobtor_website_sales.dobtor_list_table">
    <xpath expr="//t[@t-foreach='product.relational'][@t-as='item']" position="replace"></xpath>
    <xpath expr="//t[@t-set='content_index'][@t-value='0']" position="replace">
      <t t-foreach="website.get_show_info()" t-as="item">
        <div class="col-md-3 hidden-xs">
          <ul style="margin-top: 10px;">
            <li t-foreach="product.relational.search([('FKInfo','=',item.id),('product_id','=',product.id),('isvisible','=',True)])" t-as="items">
              <span t-field="items.FKContent.name" style="word-wrap: break-word;"/>
            </li>
          </ul>
        </div>
      </t>
    </xpath>
  </template>
</odoo>